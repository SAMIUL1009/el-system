<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EL System</title>

<style>
body{
    font-family:Arial;
    background:#f2f2f2;
    margin:0;
    font-size:12px;
}
.box{
    max-width:420px;
    background:#fff;
    margin:10px auto;
    padding:8px;
    border:1.5px solid #000;
}
h2{text-align:center;font-size:15px;margin:6px 0;}
input,select,button{width:100%;padding:6px;margin:4px 0;font-size:12px;}
button{background:#27ae60;color:white;border:none;}
.small-btn{background:#2980b9;}
hr{margin:8px 0;}
p{color:green;text-align:center;}
.hide{display:none;}
.msg{color:red;text-align:center;}
.tab-btns{display:flex;justify-content:space-between;margin-bottom:6px;}
.tab-btns button{width:49%;padding:6px;}
table{width:100%;border-collapse:collapse;margin-top:6px;}
td,th{border:1px solid #000;padding:4px;text-align:center;}
</style>
</head>

<body>

<div class="box">
<h2>EL System</h2>

<div class="tab-btns">
    <button onclick="showTab('admin')">Admin</button>
    <button onclick="showTab('worker')">Worker</button>
</div>

<!-- Admin Login Section -->
<div id="adminLoginSection" class="hide">
    <h2>Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Enter Admin Password">
    <button onclick="loginAdmin()">Login</button>
    <p id="loginMsg" class="msg"></p>
</div>

<!-- Admin Section -->
<div id="adminSection" class="hide">
    <h2>Admin ‚Äì EL Data Entry</h2>

    <select id="wid"></select>
    <input id="total" placeholder="Total EL (Year)" value="24">
    <button onclick="saveWorker()">Save / Update Worker</button>

    <hr>

    <h2>Add / Update Monthly EL</h2>
    <select id="mid"></select>
    <input id="month" placeholder="Month (e.g. Jan-2025)">
    <input id="el" placeholder="EL Taken">
    <button class="small-btn" onclick="addEL()">Save EL</button>

    <p id="msg"></p>
</div>

<!-- Worker Section -->
<div id="workerSection" class="hide">
    <h2>Worker EL Status</h2>
    <input id="widW" placeholder="Enter Worker ID">
    <button onclick="viewEL()">View EL</button>

    <div id="result" class="hide">
        <table>
            <tr><td>Name</td><td id="name"></td></tr>
            <tr><td>Worker ID</td><td id="widShow"></td></tr>
            <tr><td>Total EL</td><td id="totalW"></td></tr>
            <tr><td>EL Taken</td><td id="used"></td></tr>
            <tr><td><b>Remaining EL</b></td><td id="remain"></td></tr>
        </table>
        <table>
            <tr><th>Month</th><th>EL Taken</th></tr>
            <tbody id="rows"></tbody>
        </table>
    </div>
    <p id="msgW" class="msg"></p>
</div>

<script>
// üîê Admin Password
const ADMIN_PASSWORD = "1234";

// üîπ Default Workers (FIXED)
const defaultWorkers = {
  "700074":"RAKIBUL SK",
  "700087":"TUSHAR PAL",
  "700271":"AZIMUDDIN SK",
  "700274":"ARUP BHASKAR",
  "700278":"IMMAMUDDIN SK",
  "700279":"SHAFFIUDDIN SK",
  "700282":"BIDHAN CH. MONDAL",
  "700283":"ANUP MONDAL",
  "700284":"SAMJAN SK",
  "700286":"KAZI MASUD"
};

// üîπ Always rebuild workers properly
let stored = JSON.parse(localStorage.getItem("workers") || "{}");
let workers = {};

// Merge default + stored (IMPORTANT FIX)
for(let id in defaultWorkers){
    workers[id] = {
        name: defaultWorkers[id],
        total: 24,
        months: stored[id]?.months || {}
    };
}

// Save corrected data back
localStorage.setItem("workers", JSON.stringify(workers));

/* ---------- Dropdown ---------- */
function loadDropdown(){
    wid.innerHTML = "";
    mid.innerHTML = "";
    for(let id in workers){
        let text = id + " - " + workers[id].name;
        wid.innerHTML += `<option value="${id}">${text}</option>`;
        mid.innerHTML += `<option value="${id}">${text}</option>`;
    }
}
loadDropdown();

/* ---------- Tabs ---------- */
function showTab(tab){
    adminLoginSection.classList.add("hide");
    adminSection.classList.add("hide");
    workerSection.classList.add("hide");

    if(tab==="admin"){
        adminLoginSection.classList.remove("hide");
    }else{
        workerSection.classList.remove("hide");
    }
}

/* ---------- Admin Login ---------- */
function loginAdmin(){
    if(adminPass.value===ADMIN_PASSWORD){
        adminLoginSection.classList.add("hide");
        adminSection.classList.remove("hide");
        loginMsg.innerText="";
    }else{
        loginMsg.innerText="‚ùå Wrong Password";
    }
}

/* ---------- Admin ---------- */
function saveWorker(){
    workers[wid.value].total = Number(total.value) || 24;
    localStorage.setItem("workers", JSON.stringify(workers));
    msg.innerText="‚úÖ Worker Updated";
}

function addEL(){
    if(!month.value) return alert("Month ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®");
    workers[mid.value].months[month.value] = Number(el.value) || 0;
    localStorage.setItem("workers", JSON.stringify(workers));
    msg.innerText="‚úÖ EL Saved";
}

/* ---------- Worker ---------- */
function viewEL(){
    let id = widW.value.trim();
    let data = workers[id];

    if(!data){
        msgW.innerText = "‚ùå Worker ID Not Found";
        result.classList.add("hide");
        return;
    }

    // ‚úÖ NAME SHOW FIX
    document.getElementById("name").innerText = data.name;

    let usedEL = 0;
    rows.innerHTML = "";

    for(let m in data.months){
        usedEL += data.months[m];
        rows.innerHTML += `
          <tr>
            <td>${m}</td>
            <td>${data.months[m]}</td>
          </tr>`;
    }

    widShow.innerText = id;
    totalW.innerText = data.total;
    used.innerText = usedEL;
    remain.innerText = data.total - usedEL;

    msgW.innerText = "";
    result.classList.remove("hide");
}

</script>

</body>
</html>
